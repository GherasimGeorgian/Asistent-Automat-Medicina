
#%%
import numpy as np
import matplotlib.pyplot as plt
import cv2
# Thanks to the authors of: https://www.kaggle.com/paulorzp/rle-functions-run-lenght-encode-decode
def mask_to_rle(mask):
    '''
    Convert a mask into RLE
    
    Parameters: 
    mask (numpy.array): binary mask of numpy array where 1 - mask, 0 - background

    Returns: 
    sring: run length encoding 
    '''
    pixels= mask.T.flatten()
    pixels = np.concatenate([[0], pixels, [0]])
    runs = np.where(pixels[1:] != pixels[:-1])[0] + 1
    runs[1::2] -= runs[::2]
    return ' '.join(str(x) for x in runs)
#img1 =  cv2.imread("C:\\Users\\Ghera\\Desktop\\segmentation\\alte2\\small60.tiff")
img1 = cv2.imread('C:\\Users\Ghera\\Desktop\\segmentation\\realdata\\mask_perete\\22_small.tiff')
#img1 = cv2.imread("C:/Users/Ghera/Desktop/testBladder/4444_mask.jpg")
#img1 = cv2.imread("C:/Users/Ghera/Desktop/sasda/kaggle_3m/TCGA_CS_4941_19960909/TCGA_CS_4941_19960909_14_mask.tif")
#img1 = cv2.imread("C:/Users/Ghera/Desktop/segmentation/right_rotating_images_mask/small35.tiff")
plt.imshow(img1)
plt.show()

# img2 = cv2.imread("C:/Users/Ghera/Desktop/testBladder/4444.jpg")
# plt.imshow(img2)
# plt.show()

pred_mask = mask_to_rle(img1)

print(pred_mask)

def rle_to_mask(rle_string,height,width):
    '''
    convert RLE(run length encoding) string to numpy array

    Parameters: 
    rleString (str): Description of arg1 
    height (int): height of the mask
    width (int): width of the mask 

    Returns: 
    numpy.array: numpy array of the mask
    '''
    rows, cols = height, width
    if rle_string == -1:
        return np.zeros((height, width))
    else:
        rleNumbers = [int(numstring) for numstring in rle_string.split(' ')]
        rlePairs = np.array(rleNumbers).reshape(-1,2)
        img = np.zeros(rows*cols,dtype=np.uint8)
        for index,length in rlePairs:
            index -= 1
            img[index:index+length] = 255
        img = img.reshape(cols,rows)
        img = img.T
        return img
print("atat\n")


# mask_pred_test1='79137 12 79633 1 79647 15 80145 2 80157 18 80657 5 80667 22 80707 8 81164 3 81168 35 81216 11 81669 71 82180 73 82691 75 83202 77 83714 35 83756 46 84226 31 84270 16 84287 29 84738 25 84783 4 84807 22 85250 22 85326 16 85762 19 85841 14 86274 18 86355 13 86786 17 86869 13 87298 16 87382 14 87810 15 87896 13 88321 16 88409 13 88833 15 88923 11 89344 16 89437 10 89856 16 89950 10 90368 15 90463 9 90879 16 90977 8 91391 16 91490 8 91903 15 92003 8 92416 14 92515 9 92928 14 93027 10 93441 13 93539 11 93953 13 94052 11 94465 13 94565 11 94977 13 95078 11 95489 13 95591 10 96001 13 96104 10 96513 13 96617 10 97025 13 97130 9 97536 14 97643 9 98047 15 98155 9 98559 15 98668 9 99070 16 99180 9 99582 16 99693 8 100094 16 100207 6 100606 16 100719 7 101118 16 101232 7 101630 16 101744 7 102142 16 102256 8 102654 16 102769 7 103166 16 103281 8 103678 16 103793 8 104190 16 104306 7 104702 16 104818 8 105214 16 105330 8 105726 17 105843 7 106238 17 106355 8 106750 17 106867 8 107262 17 107379 8 107774 18 107891 9 108286 18 108404 8 108798 18 108916 8 109310 18 109428 9 109822 17 109941 8 110334 17 110453 8 110845 17 110965 8 111357 17 111478 8 111868 18 111990 8 112380 17 112502 8 112892 17 113014 8 113404 17 113526 8 113915 17 114039 8 114426 18 114551 8 114937 19 115063 8 115449 19 115575 9 115961 18 116087 9 116473 18 116600 8 116984 19 117112 8 117496 19 117624 8 118008 18 118136 8 118520 18 118648 8 119031 19 119160 8 119543 20 119672 7 120055 20 120184 7 120567 20 120696 7 121079 20 121208 6 121591 19 121720 5 122104 18 122232 6 122616 18 122744 7 123128 18 123256 7 123641 17 123768 7 124153 17 124280 6 124666 17 124792 7 125178 17 125304 7 125690 17 125816 7 126201 19 126329 7 126712 20 126841 6 127224 20 127354 6 127736 21 127866 7 128248 20 128378 6 128761 19 128890 7 129273 19 129402 7 129785 18 129915 5 130298 17 130427 6 130810 17 130939 5 131321 17 131451 6 131833 17 131963 6 132344 18 132475 6 132855 18 132987 6 133366 19 133499 6 133878 19 134011 6 134389 20 134523 5 134901 19 135034 7 135412 20 135546 7 135924 20 136058 7 136436 20 136570 6 136948 20 137081 7 137460 20 137593 6 137972 20 138104 8 138484 20 138616 8 138996 20 139128 8 139509 19 139640 7 140021 20 140152 8 140534 19 140664 8 141046 19 141176 8 141558 20 141688 7 142070 20 142200 4 142205 1 142582 20 142712 6 143094 19 143223 10 143605 20 143735 10 144117 20 144247 10 144628 20 144759 9 145140 20 145271 9 145652 20 145782 9 146164 20 146294 9 146675 21 146806 9 147187 21 147317 9 147699 21 147829 9 148211 21 148340 10 148723 21 148852 10 149236 20 149364 10 149748 20 149875 11 150260 21 150387 11 150771 22 150899 12 151284 21 151411 12 151796 21 151922 13 152308 21 152434 13 152820 22 152946 13 153332 22 153457 13 153844 22 153969 13 154356 22 154481 12 154868 21 154992 12 155380 21 155504 11 155891 22 156015 10 156403 21 156527 10 156915 21 157039 9 157427 20 157550 9 157939 19 158061 9 158450 20 158573 9 158962 19 159084 9 159474 19 159594 11 159986 18 160104 12 160498 18 160615 12 161010 18 161126 12 161522 18 161637 13 162034 18 162148 13 162546 18 162659 13 163057 19 163171 12 163569 18 163683 11 164081 18 164194 11 164593 18 164705 10 165105 18 165216 10 165616 19 165726 10 166128 19 166237 10 166641 18 166747 11 167153 18 167254 2 167257 12 167665 18 167764 16 168178 17 168275 16 168690 17 168787 15 169202 17 169296 17 169714 17 169805 19 170225 18 170314 21 170737 18 170819 26 171248 20 171327 25 171760 20 171836 25 172273 20 172342 29 172785 21 172851 30 173303 16 173360 30 173816 16 173870 31 174329 16 174379 33 174841 17 174887 36 175352 20 175396 38 175864 24 175902 32 175940 5 176376 63 176454 1 176894 55 177411 47 177925 43 178445 23 178474 2 178961 7 341281 12 341777 1 341791 15 342289 2 342301 18 342801 5 342811 22 342851 8 343308 3 343312 35 343360 11 343813 71 344324 73 344835 75 345346 77 345858 35 345900 46 346370 31 346414 16 346431 29 346882 25 346927 4 346951 22 347394 22 347470 16 347906 19 347985 14 348418 18 348499 13 348930 17 349013 13 349442 16 349526 14 349954 15 350040 13 350465 16 350553 13 350977 15 351067 11 351488 16 351581 10 352000 16 352094 10 352512 15 352607 9 353023 16 353121 8 353535 16 353634 8 354047 15 354147 8 354560 14 354659 9 355072 14 355171 10 355585 13 355683 11 356097 13 356196 11 356609 13 356709 11 357121 13 357222 11 357633 13 357735 10 358145 13 358248 10 358657 13 358761 10 359169 13 359274 9 359680 14 359787 9 360191 15 360299 9 360703 15 360812 9 361214 16 361324 9 361726 16 361837 8 362238 16 362351 6 362750 16 362863 7 363262 16 363376 7 363774 16 363888 7 364286 16 364400 8 364798 16 364913 7 365310 16 365425 8 365822 16 365937 8 366334 16 366450 7 366846 16 366962 8 367358 16 367474 8 367870 17 367987 7 368382 17 368499 8 368894 17 369011 8 369406 17 369523 8 369918 18 370035 9 370430 18 370548 8 370942 18 371060 8 371454 18 371572 9 371966 17 372085 8 372478 17 372597 8 372989 17 373109 8 373501 17 373622 8 374012 18 374134 8 374524 17 374646 8 375036 17 375158 8 375548 17 375670 8 376059 17 376183 8 376570 18 376695 8 377081 19 377207 8 377593 19 377719 9 378105 18 378231 9 378617 18 378744 8 379128 19 379256 8 379640 19 379768 8 380152 18 380280 8 380664 18 380792 8 381175 19 381304 8 381687 20 381816 7 382199 20 382328 7 382711 20 382840 7 383223 20 383352 6 383735 19 383864 5 384248 18 384376 6 384760 18 384888 7 385272 18 385400 7 385785 17 385912 7 386297 17 386424 6 386810 17 386936 7 387322 17 387448 7 387834 17 387960 7 388345 19 388473 7 388856 20 388985 6 389368 20 389498 6 389880 21 390010 7 390392 20 390522 6 390905 19 391034 7 391417 19 391546 7 391929 18 392059 5 392442 17 392571 6 392954 17 393083 5 393465 17 393595 6 393977 17 394107 6 394488 18 394619 6 394999 18 395131 6 395510 19 395643 6 396022 19 396155 6 396533 20 396667 5 397045 19 397178 7 397556 20 397690 7 398068 20 398202 7 398580 20 398714 6 399092 20 399225 7 399604 20 399737 6 400116 20 400248 8 400628 20 400760 8 401140 20 401272 8 401653 19 401784 7 402165 20 402296 8 402678 19 402808 8 403190 19 403320 8 403702 20 403832 7 404214 20 404344 4 404349 1 404726 20 404856 6 405238 19 405367 10 405749 20 405879 10 406261 20 406391 10 406772 20 406903 9 407284 20 407415 9 407796 20 407926 9 408308 20 408438 9 408819 21 408950 9 409331 21 409461 9 409843 21 409973 9 410355 21 410484 10 410867 21 410996 10 411380 20 411508 10 411892 20 412019 11 412404 21 412531 11 412915 22 413043 12 413428 21 413555 12 413940 21 414066 13 414452 21 414578 13 414964 22 415090 13 415476 22 415601 13 415988 22 416113 13 416500 22 416625 12 417012 21 417136 12 417524 21 417648 11 418035 22 418159 10 418547 21 418671 10 419059 21 419183 9 419571 20 419694 9 420083 19 420205 9 420594 20 420717 9 421106 19 421228 9 421618 19 421738 11 422130 18 422248 12 422642 18 422759 12 423154 18 423270 12 423666 18 423781 13 424178 18 424292 13 424690 18 424803 13 425201 19 425315 12 425713 18 425827 11 426225 18 426338 11 426737 18 426849 10 427249 18 427360 10 427760 19 427870 10 428272 19 428381 10 428785 18 428891 11 429297 18 429398 2 429401 12 429809 18 429908 16 430322 17 430419 16 430834 17 430931 15 431346 17 431440 17 431858 17 431949 19 432369 18 432458 21 432881 18 432963 26 433392 20 433471 25 433904 20 433980 25 434417 20 434486 29 434929 21 434995 30 435447 16 435504 30 435960 16 436014 31 436473 16 436523 33 436985 17 437031 36 437496 20 437540 38 438008 24 438046 32 438084 5 438520 63 438598 1 439038 55 439555 47 440069 43 440589 23 440618 2 441105 7 603425 12 603921 1 603935 15 604433 2 604445 18 604945 5 604955 22 604995 8 605452 3 605456 35 605504 11 605957 71 606468 73 606979 75 607490 77 608002 35 608044 46 608514 31 608558 16 608575 29 609026 25 609071 4 609095 22 609538 22 609614 16 610050 19 610129 14 610562 18 610643 13 611074 17 611157 13 611586 16 611670 14 612098 15 612184 13 612609 16 612697 13 613121 15 613211 11 613632 16 613725 10 614144 16 614238 10 614656 15 614751 9 615167 16 615265 8 615679 16 615778 8 616191 15 616291 8 616704 14 616803 9 617216 14 617315 10 617729 13 617827 11 618241 13 618340 11 618753 13 618853 11 619265 13 619366 11 619777 13 619879 10 620289 13 620392 10 620801 13 620905 10 621313 13 621418 9 621824 14 621931 9 622335 15 622443 9 622847 15 622956 9 623358 16 623468 9 623870 16 623981 8 624382 16 624495 6 624894 16 625007 7 625406 16 625520 7 625918 16 626032 7 626430 16 626544 8 626942 16 627057 7 627454 16 627569 8 627966 16 628081 8 628478 16 628594 7 628990 16 629106 8 629502 16 629618 8 630014 17 630131 7 630526 17 630643 8 631038 17 631155 8 631550 17 631667 8 632062 18 632179 9 632574 18 632692 8 633086 18 633204 8 633598 18 633716 9 634110 17 634229 8 634622 17 634741 8 635133 17 635253 8 635645 17 635766 8 636156 18 636278 8 636668 17 636790 8 637180 17 637302 8 637692 17 637814 8 638203 17 638327 8 638714 18 638839 8 639225 19 639351 8 639737 19 639863 9 640249 18 640375 9 640761 18 640888 8 641272 19 641400 8 641784 19 641912 8 642296 18 642424 8 642808 18 642936 8 643319 19 643448 8 643831 20 643960 7 644343 20 644472 7 644855 20 644984 7 645367 20 645496 6 645879 19 646008 5 646392 18 646520 6 646904 18 647032 7 647416 18 647544 7 647929 17 648056 7 648441 17 648568 6 648954 17 649080 7 649466 17 649592 7 649978 17 650104 7 650489 19 650617 7 651000 20 651129 6 651512 20 651642 6 652024 21 652154 7 652536 20 652666 6 653049 19 653178 7 653561 19 653690 7 654073 18 654203 5 654586 17 654715 6 655098 17 655227 5 655609 17 655739 6 656121 17 656251 6 656632 18 656763 6 657143 18 657275 6 657654 19 657787 6 658166 19 658299 6 658677 20 658811 5 659189 19 659322 7 659700 20 659834 7 660212 20 660346 7 660724 20 660858 6 661236 20 661369 7 661748 20 661881 6 662260 20 662392 8 662772 20 662904 8 663284 20 663416 8 663797 19 663928 7 664309 20 664440 8 664822 19 664952 8 665334 19 665464 8 665846 20 665976 7 666358 20 666488 4 666493 1 666870 20 667000 6 667382 19 667511 10 667893 20 668023 10 668405 20 668535 10 668916 20 669047 9 669428 20 669559 9 669940 20 670070 9 670452 20 670582 9 670963 21 671094 9 671475 21 671605 9 671987 21 672117 9 672499 21 672628 10 673011 21 673140 10 673524 20 673652 10 674036 20 674163 11 674548 21 674675 11 675059 22 675187 12 675572 21 675699 12 676084 21 676210 13 676596 21 676722 13 677108 22 677234 13 677620 22 677745 13 678132 22 678257 13 678644 22 678769 12 679156 21 679280 12 679668 21 679792 11 680179 22 680303 10 680691 21 680815 10 681203 21 681327 9 681715 20 681838 9 682227 19 682349 9 682738 20 682861 9 683250 19 683372 9 683762 19 683882 11 684274 18 684392 12 684786 18 684903 12 685298 18 685414 12 685810 18 685925 13 686322 18 686436 13 686834 18 686947 13 687345 19 687459 12 687857 18 687971 11 688369 18 688482 11 688881 18 688993 10 689393 18 689504 10 689904 19 690014 10 690416 19 690525 10 690929 18 691035 11 691441 18 691542 2 691545 12 691953 18 692052 16 692466 17 692563 16 692978 17 693075 15 693490 17 693584 17 694002 17 694093 19 694513 18 694602 21 695025 18 695107 26 695536 20 695615 25 696048 20 696124 25 696561 20 696630 29 697073 21 697139 30 697591 16 697648 30 698104 16 698158 31 698617 16 698667 33 699129 17 699175 36 699640 20 699684 38 700152 24 700190 32 700228 5 700664 63 700742 1 701182 55 701699 47 702213 43 702733 23 702762 2 703249 7'
#print(mask_pred_test1)
#print("atat\n")
# pred_mask = '0 0'
img3 = rle_to_mask(pred_mask,100,100)
plt.imshow(img3)
plt.show()

# visualize steel image with four classes of faults in seperate columns
# redImg = np.zeros(img1.shape, img1.dtype)
# redImg[:,:] = (0, 0, 255)
# redMask = cv2.bitwise_and(redImg, redImg, mask=img3)
# cv2.addWeighted(redMask, 1, img1, 1, 0, img1)

#plt.imshow(img1)
#plt.show()   



# %%
